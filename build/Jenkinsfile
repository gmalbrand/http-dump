pipeline {
    agent any
    environment {
      PATH = "/usr/local/go/bin:${env.PATH}"
    }
    stages {
        stage('Go : Download modules') {
          steps {
            dir("${env.WORKSPACE}/src"){
              sh 'go version'
              sh 'go mod download'
              sh 'go get'
            }
          }
        }
        stage('Go : build executable') {
          steps{
            dir("${env.WORKSPACE}/src"){
              sh 'go build -o http-dump main.go'
            }
          }
        }
        stage('List files') {
          steps {
              sh 'echo $PWD'
              sh 'echo "$(ls -lR)"'
          }
        }
    }
}
